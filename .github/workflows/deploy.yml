#Name for Workflow
name: Bot deploy server
on:
  #Trigger workflow when code pushed to repo
  push:
    branches:
    #Branch which you want to deploy
      - main

jobs:
  deploy:
    #Run workflow on Ubuntu operating system(it's the bestest osüòÅ)
    runs-on: ubuntu-20.04

    steps:
    #Check code from repo
    - name: Checkout code  
      uses: actions/checkout@main
      
    #setting up Python
    - name: Set up Python
      uses: actions/setup-python@v2

    #install python required pakages for make repo working from requirements.txt
    - name: Install dependencies
      run: pip install -r requirements.txt
      
    - name: Setup screen
      run: |
        sudo apt-get install -y screen  # Install screen if needed
        screen -d -m -S testbot
    - name: Setup tmux
      run: |
        sudo apt-get install -y tmux
        tmux new-session -d -s mybot

    #run the bot on workflow
    - name: Run Bot
      continue-on-error: true
      #setting Environmental Variables from Github secrets 
      env:
          API_ID: ${{ secrets.API_ID }}
          API_HASH: ${{ secrets.API_HASH }}
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      
      #start command (language directory where run codes are located
      #i am using python3 and codes file of pyrogram bot.py 
      run : |
        screen -R testbot 
        python3 bot.py 
